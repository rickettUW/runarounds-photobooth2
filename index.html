<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fangirl Photo Booth</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #0b0b10;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

/* CAMERA WRAPPER */
.app {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
}

/* CAMERA VIEW */
.camera {
  position: relative;
  flex: 1;
  overflow: hidden;
  background: black;
}

/* VIDEO */
video, canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scaleX(-1); /* mirror */
}

/* OVERLAYS */
.overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.grain {
  background: url("assets/grain.png") repeat;
  opacity: 0.18;
  mix-blend-mode: overlay;
}

.scratches {
  background: url("assets/scratches.png") repeat;
  opacity: 0.12;
}

.stars {
  background: url("assets/stars.png") repeat;
  opacity: 0.35;
}

/* COUNTDOWN ICON */
.countdown {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 88px;
  color: white;
  font-weight: 800;
  text-shadow: 0 0 20px rgba(255,255,255,.6);
  opacity: 0;
  transition: opacity .25s ease;
}

/* CONTROLS */
.controls {
  padding: 14px;
  background: rgba(0,0,0,.6);
  display: flex;
  justify-content: center;
}

button {
  appearance: none;
  border: none;
  border-radius: 999px;
  padding: 14px 22px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
}

.snap {
  background: white;
  color: black;
}
</style>
</head>

<body>
<div class="app">

  <div class="camera">
    <video id="video" autoplay muted playsinline></video>
    <canvas id="canvas"></canvas>

    <!-- EFFECT OVERLAYS -->
    <div class="overlay grain"></div>
    <div class="overlay scratches"></div>
    <div class="overlay stars"></div>

    <!-- COUNTDOWN -->
    <div id="countdown" class="countdown">‚≠ê</div>
  </div>

  <div class="controls">
    <button class="snap" id="snap">Take Photo</button>
  </div>

</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const countdownEl = document.getElementById("countdown");

let stream;

/* ENABLE CAMERA IMMEDIATELY */
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" },
    audio: false
  });
  video.srcObject = stream;
}
startCamera();

/* COUNTDOWN ICON SEQUENCE */
const icons = ["‚≠ê", "üé∏", "ü•Å", "üì∏"];

function showCountdown() {
  return new Promise(async (resolve) => {
    for (let i = 0; i < icons.length; i++) {
      countdownEl.textContent = icons[i];
      countdownEl.style.opacity = 1;
      await new Promise(r => setTimeout(r, 700));
      countdownEl.style.opacity = 0;
      await new Promise(r => setTimeout(r, 200));
    }
    resolve();
  });
}

/* TAKE PHOTO */
document.getElementById("snap").onclick = async () => {
  if (!video.videoWidth) return;

  await showCountdown();

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.filter = "grayscale(1) contrast(1.2)";
  ctx.drawImage(video, 0, 0);

  const link = document.createElement("a");
  link.download = "fangirl-photo.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};

/* CLEANUP */
window.addEventListener("pagehide", () => {
  if (stream) stream.getTracks().forEach(t => t.stop());
});
</script>
</body>
</html>
